x = linspace(0,1,20001);

y_orig= @(x) -0.594689181*(0.298222773*sqrt(x) - 0.127125232*x - 0.357907906*x.^2 + 0.291984971*x.^3 - 0.105174606*x.^4); 


y= @(x) -0.594689181*(0.298222773*sqrt(x) - 0.127125232*x - 0.357907906*x.^2 + 0.291984971*x.^3 - 0.105174606*x.^4) - 0.02*exp(-50*abs(1-x)).*sqrt(1-x); 

dy = @(x) -0.594689181*(0.298222773*0.5*1./sqrt(x) - 0.127125232 - 0.357907906*x*2 + 3*0.291984971*x.^2 - 4*0.105174606*x.^3) + exp(-50*abs(1-x)).*(0.01*abs(1-x)+(1-x).*x)./(sqrt(x).*abs(1-x)); 

d2y = @(x) -0.594689181*(0.298222773*0.5*(-0.5)*1./sqrt(x.^3) - 0.357907906*2 + 3*0.291984971*2*x - 3*4*0.105174606*x.^2) + (exp(-50*abs(x - 1)).*((x .*(x .*(50*x - 50) - 0.005) + 0.005).* abs((1 - x).^3) - (1 - x).^4 .*x))./((x - 1).*x.^(3/2).*abs((x - 1).^3));

R = ((1+dy(x).^2).^(1.5))./abs(d2y(x));
plot(x,R)

plot(x,y(x),'o-'); axis equal

xc = [];
for x1 = x

R = ((1+dy(x1).^2).^(1.5))./abs(d2y(x1));
m = -1/dy(x1);

x2 = x1 + sqrt(R^2/(1+m^2));
y2 = y(x1) + m *(x2-x1);
if (y2 < 0)
	x2 = x1 - sqrt(R^2/(1+m^2));
	y2 = y(x1) + m *(x2-x1);
end
	
%plot(x,y(x),[x1 x2],[y(x1) y2],'r'); axis equal
%hold on
xc = [xc; x2 y2];
end